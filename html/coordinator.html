<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intern Coordinator Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

  <!-- Leaflet.js -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    #map {
      height: 400px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900" style="overflow-y: auto; -webkit-overflow-scrolling: touch;">
  <!-- üîí Login/Register Modal -->
  <div
    id="authModal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  >
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
      <h2 id="modalTitle" class="text-xl font-bold mb-4 text-center">
        Coordinator Login
      </h2>
      <input
        id="email"
        type="email"
        placeholder="Email"
        class="w-full px-3 py-2 border rounded mb-3"
      />
      <input
        id="password"
        type="password"
        placeholder="Password"
        class="w-full px-3 py-2 border rounded mb-3"
      />
      <div id="extraFields" class="hidden">
        <input
          id="fullName"
          type="text"
          placeholder="Full Name"
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <input
          id="organization"
          type="text"
          placeholder="Organization"
          class="w-full px-3 py-2 border rounded mb-3"
        />
      </div>
      <button
        id="authButton"
        onclick="authAction()"
        class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition"
      >
        üîê Log In
      </button>
      <p id="authStatus" class="text-sm mt-2 text-center text-red-600"></p>
      <p class="text-sm text-center mt-4">
        <span id="togglePrompt">Don't have an account?</span>
        <button
          onclick="toggleAuthMode()"
          class="text-blue-600 hover:underline"
          id="toggleMode"
        >
          Register here
        </button>
      </p>
    </div>
  </div>

  <!-- üó∫Ô∏è Dashboard -->
  <div id="dashboard" class="hidden max-w-5xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-bold mb-6 text-center">
      üìç Coordinator Dashboard
    </h1>

    <!-- üè† Room Management -->
    <div class="mt-10 bg-white p-4 rounded shadow">
      <h2 class="text-2xl font-bold mb-4">üè† Create Room</h2>
      <p class="text-gray-600 text-sm mb-2">
        Create a dedicated room for your interns. A unique join code will be generated.
      </p>
      <input
        id="roomName"
        type="text"
        placeholder="Enter Room Name"
        class="w-full px-3 py-2 border rounded mb-3"
      />
      <button
        onclick="createRoom()"
        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition"
      >
        ‚ûï Create Room
      </button>
      <p id="roomStatus" class="text-sm mt-3 text-green-600"></p>
    </div>

    <!-- üìú Room List -->
    <div class="mt-10 bg-white p-4 rounded shadow">
      <h2 class="text-2xl font-bold mb-4">üìú My Rooms</h2>
      <ul id="roomList" class="space-y-3">
        <p class="text-sm text-gray-500">Loading rooms...</p>
      </ul>
    </div>

    <!-- Room Details Container -->
    <div
      id="roomDetailsContainer"
      data-active-room=""
      class="hidden p-4 rounded-lg bg-white mt-4"
    >
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center">
          <button
            id="backToRoomsButton"
            onclick="backToRooms()"
            class="text-gray-700 px-3 py-1 rounded-lg hover:bg-gray-300 transition mr-3"
          >
            <i class="fas fa-reply"></i>
          </button>
          <h3 id="roomDetailsTitle" class="text-lg font-bold text-blue-700">
            Room Details
          </h3>
        </div>
      </div>

      <!-- Join Code -->
      <p id="roomJoinCode" class="text-sm text-gray-600 mb-4"></p>

      <!-- Interns List -->
      <h3 class="font-semibold mb-2">Interns in this Room</h3>
      <ul id="roomInternList" class="space-y-1 mb-4">
        <li class="text-gray-500">Loading interns...</li>
      </ul>

      <!-- Add Schedule Button -->
      <button
        onclick="openScheduleModal()"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4 w-full"
      >
        Add Schedule for this Room
      </button>

      <!-- Schedule List -->
      <h3 class="font-semibold mb-2">Schedules</h3>
      <div id="scheduleCardsContainer" class="w-full">
        <p class="text-center text-gray-500 col-span-full">Loading schedules...</p>
      </div>

      <!-- Daily Times Table -->
      <div id="dailyTimesSection" class="hidden">
        <h3 class="font-semibold mb-2 mt-6">Daily Times</h3>
        <table
          id="dailyTimesTable"
          class="w-full table-auto border-collapse border border-gray-300"
        >
          <thead>
            <tr class="bg-gray-100">
              <th class="border border-gray-300 px-4 py-2">Date</th>
              <th class="border border-gray-300 px-4 py-2">Day</th>
              <th class="border border-gray-300 px-4 py-2">Start Time</th>
              <th class="border border-gray-300 px-4 py-2">End Time</th>
            </tr>
          </thead>
          <tbody id="dailyTimesTableBody">
            <tr>
              <td colspan="4" class="text-center py-4 text-gray-500">
                Select a schedule to view daily times.
              </td>
            </tr>
          </tbody>
        </table>
        <div class="flex justify-between items-center mt-4">
          <button
            id="prevDailyPageBtn"
            class="px-4 py-2 bg-gray-300 text-gray-700 rounded disabled:opacity-50"
            disabled
          >
            Previous
          </button>
          <span id="dailyPageInfo" class="text-sm">Page 1 of 1</span>
          <button
            id="nextDailyPageBtn"
            class="px-4 py-2 bg-gray-300 text-gray-700 rounded disabled:opacity-50"
            disabled
          >
            Next
          </button>
        </div>
      </div>
    </div>

    <div class="mt-10">
      <!-- üîÅ Log Out All Interns -->
      <div class="mt-10">
        <button
          onclick="logoutAllInterns()"
          class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 mr-4"
        >
          üö™ Log Out All Interns
        </button>
        <button
          onclick="coordinatorLogout()"
          class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700"
        >
          üîì Coordinator Logout
        </button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div
    id="confirmModal"
    style="display: none"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
  >
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
      <h2 class="text-xl font-bold mb-4 text-center">Confirm Login</h2>
      <p class="text-center mb-4">
        Logged in as <strong id="loggedInEmail"></strong>
      </p>
      <button
        onclick="proceedToDashboard()"
        class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 mb-2"
      >
        ‚úÖ Continue
      </button>
      <button
        onclick="logoutAndReset()"
        class="w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600"
      >
        üîÑ Use Different Account
      </button>
    </div>
  </div>

  <!-- Modal 1: Schedule Input -->
  <div
    id="scheduleInputModal"
    class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"
  >
    <div class="bg-white w-full max-w-lg rounded-2xl shadow p-6">
      <h3 id="scheduleModalTitle" class="text-xl font-bold mb-4">Edit Schedule</h3>

      <div class="grid gap-4">
        <div>
          <label class="block font-medium">Total Internship Hours</label>
          <input
            id="totalHoursInput"
            type="number"
            min="1"
            step="0.5"
            placeholder="e.g., 300"
            class="w-full px-3 py-2 border rounded"
          />
          <p id="totalHoursError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Start Date</label>
          <input
            id="startDateInput"
            type="date"
            class="w-full px-3 py-2 border rounded"
          />
          <p id="startDateError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Time Mode</label>
          <div class="flex items-center gap-4 mt-2">
            <label class="flex items-center gap-2">
              <input
                type="radio"
                name="timeMode"
                value="hoursPerDay"
                checked
              />
              <span>Start Time + Hours per Day</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="radio" name="timeMode" value="endTime" />
              <span>Start Time + End Time</span>
            </label>
          </div>
        </div>

        <div id="hoursPerDayBlock" class="grid grid-cols-2 gap-3">
          <div>
            <label class="block font-medium">Start Time</label>
            <input
              id="startTimeHPD"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <div>
            <label class="block font-medium">Hours per Day</label>
            <input
              id="hoursPerDay"
              type="number"
              min="0.5"
              step="0.25"
              placeholder="e.g., 8"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <p id="hpdError" class="text-sm text-red-600 col-span-2 hidden"></p>
        </div>

        <div id="endTimeBlock" class="grid grid-cols-2 gap-3 hidden">
          <div>
            <label class="block font-medium">Start Time</label>
            <input
              id="startTimeET"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <div>
            <label class="block font-medium">End Time</label>
            <input
              id="endTimeET"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <p id="etError" class="text-sm text-red-600 col-span-2 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Allowed Days</label>
          <div class="grid grid-cols-4 gap-2 mt-2">
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="mon"
              />Mon</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="tue"
              />Tue</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="wed"
              />Wed</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="thu"
              />Thu</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="fri"
              />Fri</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="sat"
              />Sat</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="allowedDay"
                value="sun"
              />Sun</label
            >
          </div>
          <p id="daysError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button
          class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"
          onclick="closeScheduleInputModal()"
        >
          Cancel
        </button>
        <button
          class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
          onclick="computeAndReviewSchedule()"
        >
          Next
        </button>
      </div>
    </div>
  </div>

  <!-- Modal 2: Review -->
  <div
    id="scheduleReviewModal"
    class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"
  >
    <div class="bg-white w-full max-w-lg rounded-2xl shadow p-6">
      <h3 class="text-xl font-bold mb-4">Review Schedule</h3>

      <div class="grid gap-3 text-sm">
        <div>
          <span class="font-semibold">Start Date:</span>
          <span id="revStartDate">‚Äî</span>
        </div>
        <div>
          <span class="font-semibold">End Date:</span>
          <span id="revEndDate">‚Äî</span>
        </div>
        <div>
          <span class="font-semibold">Allowed Days:</span>
          <span id="revDays">‚Äî</span>
        </div>
        <div>
          <span class="font-semibold">Daily Time:</span>
          <span id="revDailyTime">‚Äî</span>
        </div>
        <div>
          <span class="font-semibold">Last Day Time Schedule:</span>
          <span id="revLastDayTime"></span>
        </div>
        <div id="revLastDayNote" class="text-xs text-gray-600"></div>
      </div>

      <!-- Circular progress chip -->
      <div class="mt-6 flex items-center justify-center">
        <div class="relative h-28 w-28">
          <!-- 100% ring (we just show the number cleanly) -->
          <div
            class="absolute inset-0 rounded-full"
            style="
              background: conic-gradient(currentColor 100%, #e5e7eb 0);
              color: rgb(37, 99, 235);
            "
          ></div>
          <div
            class="absolute inset-2 rounded-full bg-white flex items-center justify-center"
          >
            <div class="text-center">
              <div class="text-lg font-bold" id="revTotalHours">0</div>
              <div class="text-[11px] uppercase tracking-wide text-gray-500">
                hours
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button
          class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"
          onclick="backToInput()"
        >
          Back
        </button>
        <button
          class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
          onclick="closeScheduleReviewModal(); saveSchedule();"
        >
          Done
        </button>
      </div>
    </div>
  </div>

  <!-- Modal 3: Edit Intern Schedule -->
  <div
    id="editInternScheduleModal"
    class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"
  >
    <div class="bg-white w-full max-w-lg rounded-2xl shadow p-6">
      <h3 class="text-xl font-bold mb-4">Edit Intern Schedule</h3>

      <div class="grid gap-4">
        <div>
          <label class="block font-medium">Total Internship Hours</label>
          <input
            id="editTotalHoursInput"
            type="number"
            min="1"
            step="0.5"
            placeholder="e.g., 300"
            class="w-full px-3 py-2 border rounded"
          />
          <p id="editTotalHoursError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Start Date</label>
          <input
            id="editStartDateInput"
            type="date"
            class="w-full px-3 py-2 border rounded"
          />
          <p id="editStartDateError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Time Mode</label>
          <div class="flex items-center gap-4 mt-2">
            <label class="flex items-center gap-2">
              <input
                type="radio"
                name="editTimeMode"
                value="hoursPerDay"
                checked
              />
              <span>Start Time + Hours per Day</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="radio" name="editTimeMode" value="endTime" />
              <span>Start Time + End Time</span>
            </label>
          </div>
        </div>

        <div id="editHoursPerDayBlock" class="grid grid-cols-2 gap-3">
          <div>
            <label class="block font-medium">Start Time</label>
            <input
              id="editStartTimeHPD"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <div>
            <label class="block font-medium">Hours per Day</label>
            <input
              id="editHoursPerDay"
              type="number"
              min="0.5"
              step="0.25"
              placeholder="e.g., 8"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <p id="editHpdError" class="text-sm text-red-600 col-span-2 hidden"></p>
        </div>

        <div id="editEndTimeBlock" class="grid grid-cols-2 gap-3 hidden">
          <div>
            <label class="block font-medium">Start Time</label>
            <input
              id="editStartTimeET"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <div>
            <label class="block font-medium">End Time</label>
            <input
              id="editEndTimeET"
              type="time"
              class="w-full px-3 py-2 border rounded"
            />
          </div>
          <p id="editEtError" class="text-sm text-red-600 col-span-2 hidden"></p>
        </div>

        <div>
          <label class="block font-medium">Allowed Days</label>
          <div class="grid grid-cols-4 gap-2 mt-2">
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="mon"
              />Mon</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="tue"
              />Tue</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="wed"
              />Wed</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="thu"
              />Thu</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="fri"
              />Fri</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="sat"
              />Sat</label
            >
            <label class="flex items-center gap-2"
              ><input
                type="checkbox"
                class="editAllowedDay"
                value="sun"
              />Sun</label
            >
          </div>
          <p id="editDaysError" class="text-sm text-red-600 mt-1 hidden"></p>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <button
          class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"
          onclick="closeEditInternScheduleModal()"
        >
          Cancel
        </button>
        <button
          class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"
          onclick="updateInternSchedule()"
        >
          Update Schedule
        </button>
      </div>
    </div>
  </div>

  <script src="../js/coordinator.js"></script>
</body>
</html>
