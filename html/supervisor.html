<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>INDEX: Supervisor</title>
    <meta name="description" content="Supervisor dashboard for managing interns, rooms, and geofencing.">
    <meta name="theme-color" content="#4174b8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="INDEX Supervisor">
    <link rel="manifest" href="../manifest.json">
    <link rel="apple-touch-icon" href="../images/Rmainlogo.webp">
    <link rel="icon" type="image/x-icon" href="../images/icon.ico">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- Leaflet.js -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
      #map {
        height: 400px;
      }

      .hidden {
        display: none;
      }

      /* Sidebar styles */
      .sidebar-transition {
        transition: transform 0.3s ease-in-out;
      }

      .sidebar-overlay {
        transition: opacity 0.3s ease-in-out;
      }

      /* Main content adjustment for sidebar */
      .main-content {
        margin-left: 0;
        transition: margin-left 0.3s ease-in-out;
      }

      @media (min-width: 1024px) {
        .main-content {
          margin-left: 240px;
        }
      }

      /* Mobile menu button */
      .mobile-menu-button {
        transition: transform 0.3s ease-in-out;
      }

      /* Active navigation item */
      .nav-item.active {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
      }

      /* Modal backdrop fix for sidebar */
      .modal-backdrop {
        z-index: 60;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-900" style="overflow-y: auto; -webkit-overflow-scrolling: touch;">
    <!-- Mobile menu button - positioned to follow sidebar -->
    <button
      id="mobile-menu-button"
      class="lg:hidden fixed top-4 left-4 z-50 bg-white p-2 rounded-lg shadow-lg transition-transform duration-300 ease-in-out"
    >
      <i id="menu-icon" class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div
      id="sidebar"
      class="fixed left-0 top-0 h-full w-60 bg-white shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40"
      style="background-color: #4174b8"
    >
      <!-- Sidebar Header -->
      <div class="p-4" style="border-bottom: 1px solid #2c5aa0;">
        <div class="flex items-center justify-between">
          <!-- Logo Image-->
          <div class="flex justify-center">
            <img
              src="../images/Rmainlogo.webp"
              alt="Logo"
              style="width: 200px; height: 70px; object-fit: contain"
            />
          </div>
        </div>
      </div>

      <!-- User Profile Section -->
      <div class="p-4" style="border-bottom: 1px solid #2c5aa0;">
        <div class="flex items-center">
          <div
            class="w-10 h-10 bg-blue-300 rounded-full flex items-center justify-center"
          >
            <img
              id="userPic"
              src="../images/default.webp"
              alt="User Profile"
              class="w-full h-full rounded-full object-cover"
            />
          </div>
          <div class="ml-3">
            <p id="username" class="text-sm font-medium text-white">
              Supervisor Name
            </p>
            <p id="userEmail" class="text-xs text-gray-400">supervisor@email.com</p>
          </div>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="p-4">
        <ul class="space-y-2">
          <li>
            <a
              id="dashboard-nav"
              href="#dashboard"
              class="flex items-center text-white p-3 hover:bg-gray-100 hover:text-black transition hover:rounded-lg nav-item active"
              style="border: none;"
            >
              <i class="fas fa-home mr-3"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a
              id="interns-nav"
              href="#interns"
              class="flex items-center p-3 text-white hover:bg-gray-100 hover:text-black transition hover:rounded-lg nav-item"
              style="border: none;"
            >
              <i class="fas fa-users mr-3"></i>
              <span>Interns</span>
            </a>
          </li>
          <li>
            <a
              id="rooms-nav"
              href="#rooms"
              class="flex items-center p-3 text-white hover:bg-gray-100 hover:text-black transition hover:rounded-lg nav-item"
              style="border: none;"
            >
              <i class="fas fa-building mr-3"></i>
              <span>Rooms</span>
            </a>
          </li>
          <li>
            <a
              id="settings-nav"
              href="#settings"
              class="flex items-center p-3 text-white hover:bg-gray-100 hover:text-black transition hover:rounded-lg nav-item"
              style="border: none;"
            >
              <i class="fas fa-cog mr-3"></i>
              <span>Settings</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Logout Section -->
      <div class="absolute bottom-0 left-0 right-0 p-4 border-t">
        <button
          onclick="supervisorLogout()"
          id="navItem"
          class="flex items-center w-full p-3 text-white rounded-lg hover:bg-gray-100 transition"
        >
          <i class="fas fa-sign-out-alt mr-3"></i>
          <span>Logout</span>
        </button>
      </div>
    </div>

    <!-- Overlay for mobile -->
    <div
      id="overlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden lg:hidden"
    ></div>

    <!-- ğŸ”’ Login/Register Modal -->
    <div
      id="authModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-backdrop"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
        <img src="../images/mainlogo.webp" alt="Main Logo" class="h-24 mx-auto mb-4"/>
        <h2 id="modalTitle" class="text-xl font-bold mb-4 text-center" style="color: #4174b8">
          SUPERVISOR LOGIN
        </h2>
        <input
          id="email"
          type="email"
          placeholder="Email"
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <input
          id="password"
          type="password"
          placeholder="Password"
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <div id="extraFields" class="hidden">
          <input
            id="fullName"
            type="text"
            placeholder="Full Name"
            class="w-full px-3 py-2 border rounded mb-3"
          />
          <input
            id="company"
            type="text"
            placeholder="Company Name"
            class="w-full px-3 py-2 border rounded mb-3"
          />
        </div>
        <button
          id="authButton"
          onclick="login()"
          class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition"
        >
          Log In
        </button>
        <p id="authStatus" class="text-sm mt-2 text-center text-red-600"></p>
        <p class="text-sm text-center mt-4">
          <span id="togglePrompt">Don't have an account?</span>
          <button
            onclick="toggleAuthMode()"
            class="text-blue-600 hover:underline"
            id="toggleMode"
          >
            Register here
          </button>
        </p>
      </div>
    </div>

    <!-- ğŸŒ€ Loading Overlay -->
    <div
      id="loadingOverlay"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white px-4 py-3 rounded-lg shadow-lg text-center">
        <svg
          class="animate-spin h-6 w-6 text-blue-600 mx-auto mb-2"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v8z"
          ></path>
        </svg>
        <p class="text-sm font-medium">Processing...</p>
      </div>
    </div>

    <!-- ğŸ—ºï¸ Dashboard -->
    <div id="dashboard" class="hidden main-content max-w-5xl mx-auto px-6 py-8">
      <h1 class="text-3xl font-bold mb-6 text-center">
        SUPERVISOR DASHBOARD
      </h1>


      <!-- ğŸ  Room Management -->
      <div class="mt-10 bg-white p-4 rounded shadow">
        <h2 class="text-2xl font-bold mb-4">ğŸ  Create Room</h2>
        <p class="text-gray-600 text-sm mb-2">
          Create a dedicated room for your interns. A unique join code will be generated.
        </p>
        <input 
          id="roomName" 
          type="text" 
          placeholder="Enter Room Name" 
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <button 
          onclick="createRoom()" 
          class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition"
        >
          â• Create Room
        </button>
        <p id="roomStatus" class="text-sm mt-3 text-green-600"></p>
      </div>

      <!-- ğŸ“œ Room List -->
      <div class="mt-10 bg-white p-4 rounded shadow">
        <h2 class="text-2xl font-bold mb-4">ğŸ“œ My Rooms</h2>
        <ul id="roomList" class="space-y-3">
          <p class="text-sm text-gray-500">Loading rooms...</p>
        </ul>
      </div>

      <!-- Room Details Container -->
      <div id="roomDetailsContainer" data-active-room="" class="hidden p-4 rounded-lg bg-white mt-4">
        <div class="flex justify-between items-center mb-4">
          <div class="flex items-center">
            <button id="backToRoomsButton" onclick="backToRooms()" class="text-gray-700 px-3 py-1 rounded-lg hover:bg-gray-300 transition mr-3">
              <i class="fas fa-reply"></i>
            </button>
            <h3 id="roomDetailsTitle" class="text-lg font-bold text-blue-700">Room Details</h3>
          </div>
        </div>

        <!-- Join Code -->
        <p id="roomJoinCode" class="text-sm text-gray-600 mb-4"></p>

        <!-- Interns List -->
        <h3 class="font-semibold mb-2">Interns in this Room</h3>
        <ul id="roomInternList" class="space-y-1 mb-4">
          <li class="text-gray-500">Loading interns...</li>
        </ul>



        <!-- Geofence Section -->
        <h3 class="font-semibold mb-2 mt-6">Geofence</h3>
        <div class="mb-6">
          <label class="block mb-2 font-medium">Radius (meters):</label>
          <input
            id="radiusInput"
            type="number"
            value="100"
            min="10"
            max="1000"
            step="10"
            class="w-full max-w-xs px-3 py-2 border rounded"
          />
        </div>
        <div id="map" class="w-full rounded-xl border shadow mb-6"></div>
        <div class="flex justify-end space-x-2">
          <button
            id="editGeofenceBtn"
            onclick="enableGeofenceEdit()"
            class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition"
          >
            âœï¸ Edit Geofence
          </button>
          <button
            id="saveGeofenceBtn"
            onclick="saveGeofence()"
            class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition"
            disabled
          >
            ğŸ’¾ Save Geofence
          </button>
        </div>
        <p id="status" class="mt-4 text-center font-semibold"></p>
      </div>

      <div class="mt-10">
        <h2 class="text-2xl font-bold mb-4">ğŸ§‘â€ğŸ“ Interns</h2>
        <ul
          id="internList"
          class="bg-white rounded-lg shadow p-4 space-y-2"
        ></ul>

        <!-- ğŸ” Log Out All Interns -->
        <div class="mt-10">
          <button
            onclick="logoutAllInterns()"
            class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 mr-4"
          >
            ğŸšª Log Out All Interns
          </button>
          <button
            onclick="supervisorLogout()"
            class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700"
          >
            ğŸ”“ Supervisor Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div
      id="confirmModal"
      style="display: none"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal-backdrop"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
        <img src="../images/mainlogo.webp" alt="Main Logo" class="h-24 mx-auto mb-4"/>
        <h2 class="text-xl font-bold mb-4 text-center" style="color: #4174b8">RECENT LOGIN</h2>
        <p class="text-center mb-4">
          Logged in as <strong id="loggedInEmail"></strong>
        </p>
        <button
          onclick="proceedToDashboard()"
          class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 mb-2"
        >
          âœ… Continue
        </button>
        <button
          onclick="logoutAndReset()"
          class="w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600"
        >
          ğŸ”„ Use Different Account
        </button>
      </div>
    </div>



    <!-- Include the external JavaScript file -->
    <script src="../js/supervisor.js"></script>

    <!-- Sidebar Toggle Script -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuIcon = document.getElementById('menu-icon');

        function toggleSidebar() {
          const isOpen = !sidebar.classList.contains('-translate-x-full');
          if (isOpen) {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
            menuIcon.classList.remove('fa-times');
            menuIcon.classList.add('fa-bars');
          } else {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
            menuIcon.classList.remove('fa-bars');
            menuIcon.classList.add('fa-times');
          }
        }

        mobileMenuButton.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        // Close sidebar on navigation link click (mobile)
        const navLinks = document.querySelectorAll('.nav-item');
        navLinks.forEach(link => {
          link.addEventListener('click', function() {
            if (window.innerWidth < 1024) { // Only on mobile
              toggleSidebar();
            }
          });
        });
      });
    </script>
  </body>
</html>
