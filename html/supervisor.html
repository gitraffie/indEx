<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supervisor Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- Leaflet.js -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
      #map {
        height: 400px;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body class="bg-gray-100 text-gray-900" style="overflow-y: auto; -webkit-overflow-scrolling: touch;">
    <!-- 🔒 Login/Register Modal -->
    <div
      id="authModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
        <h2 id="modalTitle" class="text-xl font-bold mb-4 text-center">
          Supervisor Login
        </h2>
        <input
          id="email"
          type="email"
          placeholder="Email"
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <input
          id="password"
          type="password"
          placeholder="Password"
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <div id="extraFields" class="hidden">
          <input
            id="fullName"
            type="text"
            placeholder="Full Name"
            class="w-full px-3 py-2 border rounded mb-3"
          />
          <input
            id="company"
            type="text"
            placeholder="Company Name"
            class="w-full px-3 py-2 border rounded mb-3"
          />
        </div>
        <button
          id="authButton"
          onclick="login()"
          class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition"
        >
          🔐 Log In
        </button>
        <p id="authStatus" class="text-sm mt-2 text-center text-red-600"></p>
        <p class="text-sm text-center mt-4">
          <span id="togglePrompt">Don't have an account?</span>
          <button
            onclick="toggleAuthMode()"
            class="text-blue-600 hover:underline"
            id="toggleMode"
          >
            Register here
          </button>
        </p>
      </div>
    </div>

    <!-- 🌀 Loading Overlay -->
    <div
      id="loadingOverlay"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white px-4 py-3 rounded-lg shadow-lg text-center">
        <svg
          class="animate-spin h-6 w-6 text-blue-600 mx-auto mb-2"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8v8z"
          ></path>
        </svg>
        <p class="text-sm font-medium">Processing...</p>
      </div>
    </div>

    <!-- 🗺️ Dashboard -->
    <div id="dashboard" class="hidden max-w-5xl mx-auto px-6 py-8">
      <h1 class="text-3xl font-bold mb-6 text-center">
        📍 Supervisor Dashboard
      </h1>


      <!-- 🏠 Room Management -->
      <div class="mt-10 bg-white p-4 rounded shadow">
        <h2 class="text-2xl font-bold mb-4">🏠 Create Room</h2>
        <p class="text-gray-600 text-sm mb-2">
          Create a dedicated room for your interns. A unique join code will be generated.
        </p>
        <input 
          id="roomName" 
          type="text" 
          placeholder="Enter Room Name" 
          class="w-full px-3 py-2 border rounded mb-3"
        />
        <button 
          onclick="createRoom()" 
          class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition"
        >
          ➕ Create Room
        </button>
        <p id="roomStatus" class="text-sm mt-3 text-green-600"></p>
      </div>

      <!-- 📜 Room List -->
      <div class="mt-10 bg-white p-4 rounded shadow">
        <h2 class="text-2xl font-bold mb-4">📜 My Rooms</h2>
        <ul id="roomList" class="space-y-3">
          <p class="text-sm text-gray-500">Loading rooms...</p>
        </ul>
      </div>

      <!-- Room Details Container -->
      <div id="roomDetailsContainer" data-active-room="" class="hidden p-4 rounded-lg bg-white mt-4">
        <div class="flex justify-between items-center mb-4">
          <div class="flex items-center">
            <button id="backToRoomsButton" onclick="backToRooms()" class="text-gray-700 px-3 py-1 rounded-lg hover:bg-gray-300 transition mr-3">
              <i class="fas fa-reply"></i>
            </button>
            <h3 id="roomDetailsTitle" class="text-lg font-bold text-blue-700">Room Details</h3>
          </div>
        </div>

        <!-- Join Code -->
        <p id="roomJoinCode" class="text-sm text-gray-600 mb-4"></p>

        <!-- Interns List -->
        <h3 class="font-semibold mb-2">Interns in this Room</h3>
        <ul id="roomInternList" class="space-y-1 mb-4">
          <li class="text-gray-500">Loading interns...</li>
        </ul>



        <!-- Geofence Section -->
        <h3 class="font-semibold mb-2 mt-6">Geofence</h3>
        <div class="mb-6">
          <label class="block mb-2 font-medium">Radius (meters):</label>
          <input
            id="radiusInput"
            type="number"
            value="100"
            min="10"
            max="1000"
            step="10"
            class="w-full max-w-xs px-3 py-2 border rounded"
          />
        </div>
        <div id="map" class="w-full rounded-xl border shadow mb-6"></div>
        <div class="flex justify-end space-x-2">
          <button
            id="editGeofenceBtn"
            onclick="enableGeofenceEdit()"
            class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition"
          >
            ✏️ Edit Geofence
          </button>
          <button
            id="saveGeofenceBtn"
            onclick="saveGeofence()"
            class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition"
            disabled
          >
            💾 Save Geofence
          </button>
        </div>
        <p id="status" class="mt-4 text-center font-semibold"></p>
      </div>

      <div class="mt-10">
        <h2 class="text-2xl font-bold mb-4">🧑‍🎓 Interns</h2>
        <ul
          id="internList"
          class="bg-white rounded-lg shadow p-4 space-y-2"
        ></ul>

        <!-- 🔁 Log Out All Interns -->
        <div class="mt-10">
          <button
            onclick="logoutAllInterns()"
            class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 mr-4"
          >
            🚪 Log Out All Interns
          </button>
          <button
            onclick="supervisorLogout()"
            class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700"
          >
            🔓 Supervisor Logout
          </button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div
      id="confirmModal"
      style="display: none"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
        <h2 class="text-xl font-bold mb-4 text-center">Confirm Login</h2>
        <p class="text-center mb-4">
          Logged in as <strong id="loggedInEmail"></strong>
        </p>
        <button
          onclick="proceedToDashboard()"
          class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 mb-2"
        >
          ✅ Continue
        </button>
        <button
          onclick="logoutAndReset()"
          class="w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600"
        >
          🔄 Use Different Account
        </button>
      </div>
    </div>



    <!-- Include the external JavaScript file -->
    <script src="../js/supervisor.js"></script>
  </body>
</html>
